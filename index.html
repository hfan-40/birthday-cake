<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Rose Gold & Ivory 3D</title>
    <link rel="icon" href="data:,">
    <style>
        @import url('https://gs.jurieo.com/gemini/fonts-googleapis/css2?family=Cinzel:wght@700&family=Playfair+Display:ital@1&display=swap');
        :root { --gold: #D4AF37; --pink: #F19EB5; --ivory: #FFFFF0; }
        body, html, #root { margin: 0; padding: 0; width: 100%; height: 100%; overflow: hidden; background: #050505; }
        .ui { position: absolute; inset: 0; pointer-events: none; z-index: 10; display: flex; flex-direction: column; align-items: center; justify-content: space-between; padding: 5rem 1rem; box-sizing: border-box; }
        .title { font-family: 'Cinzel', serif; font-size: clamp(2rem, 8vw, 3.5rem); letter-spacing: 0.3em; background: linear-gradient(to bottom, #f4e4bc, var(--gold), #f4e4bc); -webkit-background-clip: text; -webkit-text-fill-color: transparent; text-align: center; }
        .hint { color: var(--pink); font-size: 0.85rem; letter-spacing: 0.2em; text-transform: uppercase; animation: pulse 3s infinite; font-family: 'Playfair Display', serif; }
        @keyframes pulse { 0%, 100% { opacity: 0.2; } 50% { opacity: 0.8; } }
    </style>

    <script type="importmap">
    {
      "imports": {
        "react": "https://esm.sh/react@18.2.0",
        "react-dom": "https://esm.sh/react-dom@18.2.0",
        "three": "https://esm.sh/three@0.160.0",
        "@react-three/fiber": "https://esm.sh/@react-three/fiber@8.15.11?deps=three@0.160.0",
        "@react-three/drei": "https://esm.sh/@react-three/drei@9.88.11?deps=three@0.160.0,react@18.2.0,react-dom@18.2.0"
      }
    }
    </script>
</head>
<body>
    <div id="root"></div>
    <div class="ui">
        <h1 class="title">Happy Birthday</h1>
        <div class="hint">Tap to Ignite the Celebration</div>
    </div>

    <script type="module">
        import React, { useRef, useState, useEffect, useMemo } from 'react';
        import { createRoot } from 'react-dom';
        import * as THREE from 'three';
        import { Canvas, useFrame, useThree } from '@react-three/fiber';
        import { Environment, MeshReflectorMaterial, PresentationControls, Float } from '@react-three/drei';

        // 稳定性保障：手动配置 Renderer
        const SceneSetup = () => {
            const { gl, scene } = useThree();
            useEffect(() => {
                gl.outputColorSpace = THREE.SRGBColorSpace;
                gl.toneMapping = THREE.ACESFilmicToneMapping;
                
                // 使用原生原生方法创建背景粒子，避开 Drei 库可能的组件报错
                const vertices = [];
                for (let i = 0; i < 5000; i++) {
                    vertices.push(THREE.MathUtils.randFloatSpread(100), THREE.MathUtils.randFloatSpread(100), THREE.MathUtils.randFloatSpread(100));
                }
                const geometry = new THREE.BufferGeometry();
                geometry.setAttribute('position', new THREE.Float32BufferAttribute(vertices, 3));
                const material = new THREE.PointsMaterial({ color: 0x444444, size: 0.1 });
                const points = new THREE.Points(geometry, material);
                scene.add(points);
            }, [gl, scene]);
            return null;
        };

        const CakeModel = ({ active }) => {
            const group = useRef();
            useFrame((state) => {
                if (group.current) {
                    group.current.rotation.y = Math.sin(state.clock.getElapsedTime() * 0.1) * 0.1;
                }
            });

            return React.createElement('group', { ref: group, position: [0, -0.5, 0] },
                // 1. 三层象牙白 & 玫瑰粉结构
                [[2.2, 1.2, 0, "#FFFFF0"], [1.6, 1.1, 1.15, "#F19EB5"], [1, 1, 2.2, "#FFFFF0"]].map(([r, h, y, c], i) => (
                    React.createElement('mesh', { key: i, position: [0, y, 0], castShadow: true },
                        React.createElement('cylinderGeometry', { args: [r, r, h, 64] }),
                        React.createElement('meshStandardMaterial', { color: c, roughness: 0.2 })
                    )
                )),
                // 2. 金属金装饰环 (Torus)
                [[2.25, 0], [1.65, 1.15], [1.05, 2.2]].map(([r, y], i) => (
                    React.createElement('mesh', { key: i + 10, position: [0, y, 0], rotation: [Math.PI/2, 0, 0] },
                        React.createElement('torusGeometry', { args: [r, 0.035, 16, 100] }),
                        React.createElement('meshStandardMaterial', { color: "#D4AF37", metalness: 1, roughness: 0.05 })
                    )
                )),
                // 3. 仪式感蜡烛
                React.createElement('group', { position: [0, 2.8, 0] },
                    React.createElement('mesh', null,
                        React.createElement('cylinderGeometry', { args: [0.03, 0.03, 0.6] }),
                        React.createElement('meshStandardMaterial', { color: "#D4AF37", metalness: 0.9 })
                    ),
                    active && React.createElement(React.Fragment, null,
                        React.createElement('pointLight', { intensity: 10, distance: 8, color: "#FF8000" }),
                        React.createElement(Float, { speed: 5, floatIntensity: 2 },
                            React.createElement('mesh', { position: [0, 0.45, 0] },
                                React.createElement('sphereGeometry', { args: [0.07, 16, 16] }),
                                React.createElement('meshBasicMaterial', { color: "#FFFFFF" })
                            )
                        )
                    )
                )
            );
        };

        const App = () => {
            const [lit, setLit] = useState(false);

            return React.createElement(Canvas, { 
                shadows: true, 
                camera: { position: [0, 2, 10], fov: 35 },
                onPointerDown: () => setLit(true)
            },
                React.createElement(SceneSetup, null),
                React.createElement('color', { attach: "background", args: ["#050505"] }),
                
                // 原生光照系统
                React.createElement('ambientLight', { intensity: lit ? 0.8 : 0.3 }),
                React.createElement('directionalLight', { position: [5, 10, 5], intensity: 2, castShadow: true }),

                React.createElement(PresentationControls, { 
                    global: true, snap: true, speed: 1.2,
                    rotation: [0, 0.4, 0], polar: [-Math.PI/8, Math.PI/8]
                },
                    React.createElement(CakeModel, { active: lit })
                ),

                React.createElement(Environment, { preset: "city" }),

                // 反射地面
                React.createElement('mesh', { rotation: [-Math.PI / 2, 0, 0], position: [0, -1.8, 0] },
                    React.createElement('planeGeometry', { args: [30, 30] }),
                    React.createElement(MeshReflectorMaterial, {
                        blur: [300, 100], resolution: 512, mixBlur: 1, mixStrength: 20,
                        color: "#101010", metalness: 0.5
                    })
                )
            );
        };

        createRoot(document.getElementById('root')).render(React.createElement(App));
    </script>
</body>
</html>
