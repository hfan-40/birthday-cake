<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Rose Gold 3D - Ultimate Stability</title>
    <style>
        @import url('https://gs.jurieo.com/gemini/fonts-googleapis/css2?family=Cinzel:wght@700&family=Playfair+Display:ital@1&display=swap');
        :root { --gold: #D4AF37; --pink: #F19EB5; --ivory: #FFFFF0; }
        body, html, #root { margin: 0; padding: 0; width: 100%; height: 100%; overflow: hidden; background: #050505; }
        .ui { position: absolute; inset: 0; pointer-events: none; z-index: 10; display: flex; flex-direction: column; align-items: center; justify-content: space-between; padding: 4rem 1rem; }
        .title { font-family: 'Cinzel', serif; font-size: 2.8rem; letter-spacing: 0.3em; background: linear-gradient(to bottom, #f4e4bc, var(--gold), #f4e4bc); -webkit-background-clip: text; -webkit-text-fill-color: transparent; text-align: center; }
        .hint { color: var(--pink); font-size: 0.8rem; letter-spacing: 0.2em; text-transform: uppercase; animation: breathe 3s infinite; }
        @keyframes breathe { 0%, 100% { opacity: 0.2; } 50% { opacity: 0.7; } }
    </style>

    <script type="importmap">
    {
      "imports": {
        "react": "https://esm.sh/react@18.2.0",
        "react-dom": "https://esm.sh/react-dom@18.2.0",
        "three": "https://esm.sh/three@0.160.0",
        "@react-three/fiber": "https://esm.sh/@react-three/fiber@8.15.11?deps=three@0.160.0",
        "@react-three/drei": "https://esm.sh/@react-three/drei@9.88.11?deps=three@0.160.0,react@18.2.0,react-dom@18.2.0"
      }
    }
    </script>
</head>
<body>
    <div id="root"></div>
    <div class="ui">
        <h1 class="title">Happy Birthday</h1>
        <p class="hint">Interact to celebrate</p>
    </div>

    <script type="module">
        import React, { useRef, useState, useEffect } from 'react';
        import { createRoot } from 'react-dom';
        import * as THREE from 'three';
        import { Canvas, useFrame, useThree } from '@react-three/fiber';
        import { Float, Environment, MeshReflectorMaterial, Sparkles, PresentationControls, Stars } from '@react-three/drei';

        // 核心稳定性配置
        const EngineConfig = () => {
            const { gl } = useThree();
            useEffect(() => {
                // 彻底废弃旧版 Encoding，强制使用新版 ColorSpace
                if (gl) {
                    gl.outputColorSpace = THREE.SRGBColorSpace;
                    gl.toneMapping = THREE.ACESFilmicToneMapping;
                }
            }, [gl]);
            return null;
        };

        const Cake = ({ active }) => {
            const group = useRef();
            useFrame((state) => {
                if (group.current) {
                    group.current.rotation.y = Math.sin(state.clock.getElapsedTime() * 0.2) * 0.15;
                }
            });

            return React.createElement('group', { ref: group, position: [0, -1, 0] },
                // 1. 结构层 (象牙白 & 玫瑰粉)
                [[2.2, 1.2, 0, "#FFFFF0"], [1.6, 1.1, 1.15, "#F19EB5"], [1, 1, 2.2, "#FFFFF0"]].map(([r, h, y, c], i) => (
                    React.createElement('mesh', { key: i, position: [0, y, 0], castShadow: true },
                        React.createElement('cylinderGeometry', { args: [r, r, h, 64] }),
                        React.createElement('meshStandardMaterial', { color: c, roughness: 0.2 })
                    )
                )),
                // 2. 金属金装饰环
                [[2.25, 0], [1.65, 1.15], [1.05, 2.2]].map(([r, y], i) => (
                    React.createElement('mesh', { key: i + 10, position: [0, y, 0], rotation: [Math.PI/2, 0, 0] },
                        React.createElement('torusGeometry', { args: [r, 0.04, 16, 100] }),
                        React.createElement('meshStandardMaterial', { color: "#D4AF37", metalness: 1, roughness: 0.1 })
                    )
                )),
                // 3. 蜡烛与点亮效果
                React.createElement('group', { position: [0, 2.8, 0] },
                    React.createElement('mesh', null,
                        React.createElement('cylinderGeometry', { args: [0.03, 0.03, 0.6] }),
                        React.createElement('meshStandardMaterial', { color: "#D4AF37", metalness: 0.8 })
                    ),
                    active && React.createElement(React.Fragment, null,
                        React.createElement(Sparkles, { count: 40, scale: 2, size: 4, speed: 0.5, color: "#D4AF37" }),
                        React.createElement('pointLight', { intensity: 8, distance: 10, color: "#FF8000" }),
                        React.createElement(Float, { speed: 4, rotationIntensity: 1, floatIntensity: 1 },
                            React.createElement('mesh', { position: [0, 0.45, 0] },
                                React.createElement('sphereGeometry', { args: [0.08, 16, 16] }),
                                React.createElement('meshBasicMaterial', { color: "#FFFFFF" })
                            )
                        )
                    )
                )
            );
        };

        const App = () => {
            const [lit, setLit] = useState(false);
            return React.createElement(Canvas, { 
                shadows: true, 
                camera: { position: [0, 2, 10], fov: 35 },
                onPointerDown: () => setLit(true) 
            },
                React.createElement(EngineConfig, null),
                React.createElement('color', { attach: "background", args: ["#050505"] }),
                
                // 灯光：使用原生 SpotLight 避开 Drei 组件可能的 SyntaxError
                React.createElement('ambientLight', { intensity: lit ? 0.7 : 0.2 }),
                React.createElement('spotLight', { 
                    position: [10, 10, 10], 
                    angle: 0.15, 
                    penumbra: 1, 
                    intensity: 3, 
                    castShadow: true 
                }),

                React.createElement(PresentationControls, { 
                    global: true, snap: true, speed: 1.5,
                    rotation: [0, 0.2, 0], polar: [-Math.PI/4, Math.PI/4] 
                },
                    React.createElement(Cake, { active: lit })
                ),

                React.createElement(Stars, { radius: 100, count: 2500, factor: 4 }),
                React.createElement(Environment, { preset: "city" }),

                // 反射地面
                React.createElement('mesh', { rotation: [-Math.PI / 2, 0, 0], position: [0, -2, 0] },
                    React.createElement('planeGeometry', { args: [50, 50] }),
                    React.createElement(MeshReflectorMaterial, {
                        blur: [300, 100], resolution: 512, mixBlur: 1, mixStrength: 10,
                        color: "#151515", metalness: 0.5
                    })
                )
            );
        };

        createRoot(document.getElementById('root')).render(React.createElement(App));
    </script>
</body>
</html>
